---
title: "Developing real-time forecasting models with nowcasting package"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


The nowcasting package contains useful tools for developing real-time forecasting models so that researchers can find in this package a simple and practical way to reproduce several of these models. In this version of the package we present three methods, based on seminal articles in this literature: *Giannone et al. 2008*, *Bańbura et al. 2011* and *Bańbura and Rünstler 2011*. The package also provides vintages (information observed at the time of publication) of Brazilian economic data.

## Examples

Two examples of how the nowcasting package can be used are discussed below. In the first example we use the dataset in the classic paper by *Giannone et al. (2008)*, which uses a panel of time series for the US economy, and in the second we show how to obtain vintages for the main series for the Brazilian economy.

### Nowcasting US GDP

The dataset used in *Giannone et al. (2008)* can be added to the environment with the following command.

```{r warning=FALSE}
library(nowcasting)
data(USGDP)
```

USDGP is a list with two data frames:

* `USGDP$base`: this is an unbalanced panel with the model variables;
* `USGDP$legend`: this contains the legend with the relevant information for each variable in the `USGDP$base` dataframe.

The first step is to define the variables $y_{t}$ (quarterly) and $x_{t}$ (monthly). To identify the variable that represents the GDP in the dataset, view the legend in `USGDP$legend`. Then the GDP is selected in the dataset and transformed into a quarterly variable by `month2qtr` function. The explanatory variables are all the other variables in the dataset.

```{r warning=FALSE}
gdp <- month2qtr(x = USGDP$base[,"RGDPGR"])
```

The second step covers the treatment of the explanatory variables, that will be done by `Bpanel` function. This function creates a balanced panel using an unbalanced panel as input. The missing observations and outliers are substituted using the outlier correction methodology in *Giannone et al. (2008)* and there are some transformation options that make the variables stationary. The object `USGDP$legend` contains all the transformations used in *Giannone et al. (2008)*. The `Bpanel` function also allows monthly variables to be aggregated to represent quarterly quantities.

```{r warning=FALSE}
gdp_position <- which(colnames(USGDP$base) == "RGDPGR")
base <- Bpanel(base = USGDP$base[,-gdp_position], trans = USGDP$legend$Transformation[-gdp_position], aggregate = TRUE)
```

Once these variables have been treated, the `nowcast` function can be used to estimate the model parameters according to the estimation method selected, the number *r* of dynamic factors, the lag order of the factors *p* and the number *q* of shocks in the factors. In this example we use the *Two-Stage - quarterly factors* method. The arguments *r*, *p* and *q* were defined according to *Giannone et al. (2008)*.


```{r warning=FALSE}
nowcastUSGDP <- nowcast(y = gdp, x = base, r = 2, p = 2, q = 2, method = '2sq')
```

To see the results of the forecasts in the object `nowcastUSGDP`, use `$yfcst` as shown below.

```{r warning=FALSE}
tail(nowcastUSGDP$yfcst,8)
```

The regression between $y_{t}$ and its factors can be accessed using `$reg`.

```{r warning=FALSE}
summary(nowcastUSGDP$reg)
```

All the results related to the estimation of factors are in `$factors`, including the parameters of the matrices $\Lambda$ and $A$.

```{r warning=FALSE}
tail(nowcastUSGDP$factors$dynamic_factors) # factors
```

```{r warning=FALSE}
head(nowcastUSGDP$factors$Lambda) # Lambda matrix
```

```{r warning=FALSE}
nowcastUSGDP$factors$A # A matrix
```

```{r warning=FALSE}
nowcastUSGDP$factors$BB # BB': u's variance covariance matrix (factor equation)
```

```{r warning=FALSE}
diag(nowcastUSGDP$factors$Psi) # Psi: epsilon's variance covariance matrix (x equation)
```

The forecasts of the explanatory variables are in `$xfcst`.

```{r warning=FALSE}
tail(nowcastUSGDP$xfcst[,1:5]) # x forecasts (first 5 variables)
```

The graphs available with the `nowcast.plot` function are shown below. These allow the forecast of the variable of interest and the estimated factors to be easily viewed. The graphs show how much of the variability in the dataset is explained by each factor and the importance of each variable in the first factor. Most of the variables have a negative weight.

```{r warning=FALSE}
nowcast.plot(nowcastUSGDP, type = "fcst")
```

```{r warning=FALSE}
nowcast.plot(nowcastUSGDP, type = "factors")
```

```{r warning=FALSE}
nowcast.plot(nowcastUSGDP, type = "eigenvalues")
```

```{r warning=FALSE}
nowcast.plot(nowcastUSGDP, type = "eigenvectors")
```

### Vintages

Vintage in this context refers to the dataset observed on a specific date. It is useful to assess the performance of models with information published at different times and so reproduce the real past.

The **nowcasting** package contains a dataset of very important Brazilian economic time series, which can be accessed with the `RTDB` function. If no argument is specified, the codes of all the available series are returned. The codes are the same as those used on the Central Bank of Brazil platform to download time series.

```{r warning=FALSE}
head(RTDB())
```

If the user specifies the code of the series of interest, the dates of the available vintages will be returned. If only the date of the vintage is specified, the available codes will be returned. If both options are specified, the vintage for the chosen series will be returned.

```{r warning=FALSE}
head(RTDB(series_code = 1))  # serie 1: availables vintages
```

```{r warning=FALSE}
 head(RTDB(vintage = "2017-04-04")) # vintage 2017-04-04: availables series
```

```{r warning=FALSE}
tail(RTDB(series_code = 1, vintage = "2017-04-04")) # serie 1, vintage 2017-04-04: data
```

The `PRTDB` function is intended to simulate the vintages of any dataset. The function only excludes observations from the time series based on lag information provided by the user and simulates what would be observed on the reference date.

```{r warning=FALSE}
tail(BRGDP)
```

```{r warning=FALSE}
tail(PRTDB(mts = BRGDP, delay = c(1,30,60,90,20,10,30,60), vintage = "2017-10-01"))
```

